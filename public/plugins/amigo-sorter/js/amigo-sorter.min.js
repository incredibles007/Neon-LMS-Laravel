$.fn.amigoSorter=function(e){var t=$.extend({li_helper:"li_helper",li_empty:"empty",onTouchStart:function(){},onTouchMove:function(){},onTouchEnd:function(){}},e),o=!1,n=null,l=null,r=0,a=0,s="mouseup touchend",c="mousemove touchmove",h="mousedown touchstart";return $(document.body).append($.fn.amigoSorter.li_helper(t.li_helper)),$(document).on(s,function(e){e.stopPropagation(),e.preventDefault(),o=!1,l.attr("data-action",!1),l.find("li").removeClass(t.li_empty),$("."+t.li_helper).css("display","none").html(""),t.onTouchEnd.call()}),this.each(function(e){l=$(this),$(document).on(c,function(e){if(t.onTouchMove.call(),1==o){if("touchmove"==e.type){var s=e.originalEvent.touches[0]||e.originalEvent.changedTouches[0];$.fn.amigoSorter.set_drag_pos(t.li_helper,s.clientX-r,s.clientY-a)}else $.fn.amigoSorter.set_drag_pos(t.li_helper,e.pageX-r,e.pageY-a);l.find("> li").each(function(){var o=$(this),r=o.find("> span");if(!o.hasClass(t.li_empty)){var a=(o.offset(),r.offset()),s=a.left,c=a.top,h=a.left+r.outerWidth(),p=a.top+r.outerHeight(),f=0,u=0;if("touchmove"==e.type){var g=e.originalEvent.touches[0]||e.originalEvent.changedTouches[0];f=g.clientX,u=g.clientY}else f=e.pageX,u=e.pageY;if(f>s&&h>f&&u>c&&p>u){var d=o.index(),_=Math.abs(d-n);for(i=1;i<=_;i++)d>=n?(l.find("> li").eq(n).insertAfter(l.find("> li").eq(n+1)),n++):(l.find("> li").eq(n-1).insertAfter(l.find("> li").eq(n)),n--)}}})}}),l.find("> li").on(h,function(e){var i=$(this);l=i.closest("ul"),e.stopPropagation(),e.preventDefault(),t.onTouchStart.call(),o=!0,l.attr("data-action",!0);var s=i.offset();if("touchstart"==e.type){var c=e.originalEvent.touches[0]||e.originalEvent.changedTouches[0];r=c.clientX-s.left,a=c.clientY-s.top}else r=e.pageX-s.left,a=e.pageY-s.top;var h=i.html();if(n=i.index(),i.addClass(t.li_empty),$.fn.amigoSorter.set_li_helper_size(i,t.li_helper),"touchstart"==e.type){var c=e.originalEvent.touches[0]||e.originalEvent.changedTouches[0];$.fn.amigoSorter.set_drag_pos(t.li_helper,c.clientX-r,c.clientY-a)}else $.fn.amigoSorter.set_drag_pos(t.li_helper,e.pageX-r,e.pageY-a);$("."+t.li_helper).html(h).css("display","inline-block")})})},$.fn.amigoSorter.li_helper=function(e){return'<span class="'+e+'"></span>'},$.fn.amigoSorter.set_drag_pos=function(e,t,o){return $("."+e).css("left",t).css("top",o),!0},$.fn.amigoSorter.set_li_helper_size=function(e,t){var o=e.outerWidth(),i=e.outerHeight();return $("."+t).css("width",o+"px").css("height",i+"px"),!0};
